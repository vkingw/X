{
  "always_run_in_app" : false,
  "icon" : {
    "color" : "yellow",
    "glyph" : "magic"
  },
  "name" : "国上国网",
  "author":"小白脸",
  "script" : "\/\/ Variables used by Scriptable.\n\/\/ These must be at the very top of the file. Do not edit.\n\/\/ icon-color: yellow; icon-glyph: magic;\nconst icons = {\n\tcolor: Color.dynamic(\n\t\tnew Color(\"#181819\"), \n\t\tnew Color(\"#CCCCD1\")\n\t\t),\n\tlargeSize: new Size(18, 18),\n\tmediumSize: new Size(14, 14),\n\tsmallSize: new Size(11, 11),\n\ttoFont(size) {\n\t\treturn this[size].width;\n\t},\n\n\t游戏: \"gamecontroller\",\n\t闪电: \"bolt.horizontal.circle\",\n\t家: \"house.fill\",\n\t眼睛: \"eye.fill\",\n\t货币: \"chineseyuanrenminbisign.circle\",\n\t刷新: \"arrow.triangle.2.circlepath\",\n\tgetImage(name, size = 18) {\n\t\tconst sfs = SFSymbol.named(this[name]);\n\t\tsfs.applyFont(Font.systemFont(size));\n\t\treturn sfs.image;\n\t},\n};\n\nconst BillStyle = {\n\tcolor: icons.color,\n\tlargeFont: Font.boldSystemFont(icons.toFont(\"largeSize\")),\n\tmediumFont: Font.boldSystemFont(icons.toFont(\"mediumSize\")),\n\tsmallFont: Font.regularSystemFont(icons.toFont(\"smallSize\")),\n};\n\nObject.prototype.myProxy = function (obj) {\n\tReflect.ownKeys(obj).forEach((key) => {\n\t\tconst value = obj[key];\n\n\t\tif (typeof value === \"function\") {\n\t\t\tvalue(this);\n\t\t\treturn;\n\t\t}\n\n\t\tif (typeof this[key] !== \"function\") {\n\t\t\tthis[key] = value;\n\t\t\treturn;\n\t\t}\n\n\t\tif (Array.isArray(value)) {\n\t\t\tconst [arg, cbObj] = value;\n\t\t\tthis[key](arg).myProxy({ ...cbObj });\n\t\t} else {\n\t\t\tthis[key](value);\n\t\t}\n\t});\n\n\treturn this;\n};\n\n\/**\n * @param {object} options\n * @param {string} [options.title]\n * @param {string} [options.message]\n * @param {Array<{ title: string; [key: string]: any }>} options.options\n * @param {boolean} [options.showCancel = true]\n * @param {string} [options.cancelText = 'Cancel']\n *\/\nconst presentSheet = async (options) => {\n\toptions = {\n\t\tshowCancel: true,\n\t\tcancelText: \"Cancel\",\n\t\t...options,\n\t};\n\tconst alert = new Alert();\n\tif (options.title) {\n\t\talert.title = options.title;\n\t}\n\tif (options.message) {\n\t\talert.message = options.message;\n\t}\n\tif (!options.options) {\n\t\tthrow new Error(\n\t\t\t'The \"options\" property of the parameter cannot be empty'\n\t\t);\n\t}\n\tfor (const option of options.options) {\n\t\talert.addAction(option.title);\n\t}\n\tif (options.showCancel) {\n\t\talert.addCancelAction(options.cancelText);\n\t}\n\tconst value = await alert.presentSheet();\n\treturn {\n\t\tvalue,\n\t\toption: options.options[value],\n\t};\n};\n\n\/**\n * 弹出选项\n * @param message 描述内容\n * @param options 按钮\n * @returns {Promise<number>}\n *\/\n\nasync function generateAlert(message, options = []) {\n  let alert = new Alert();\n  alert.message = message;\n\n  for (const option of options) {\n    alert.addAction(option);\n  }\n  const index = await alert.presentAlert();\n  return options[index];\n}\n\n\/**\n * Thanks @mzeryck\n *\n * @param {number} [height] The screen height measured in pixels\n *\/\nconst phoneSize = (height) => {\n\tconst phones = {\n\t\t\/** 14 Pro Max *\/\n\t\t2796: {\n\t\t\tsmall: 510,\n\t\t\tmedium: 1092,\n\t\t\tlarge: 1146,\n\t\t\tleft: 99,\n\t\t\tright: 681,\n\t\t\ttop: 282,\n\t\t\tmiddle: 918,\n\t\t\tbottom: 1554,\n\t\t},\n\t\t\/** 14 Pro *\/\n\t\t2556: {\n\t\t\tsmall: 474,\n\t\t\tmedium: 1014,\n\t\t\tlarge: 1062,\n\t\t\tleft: 82,\n\t\t\tright: 622,\n\t\t\ttop: 270,\n\t\t\tmiddle: 858,\n\t\t\tbottom: 1446,\n\t\t},\n\t\t\/** 13 Pro Max, 12 Pro Max *\/\n\t\t2778: {\n\t\t\tsmall: 510,\n\t\t\tmedium: 1092,\n\t\t\tlarge: 1146,\n\t\t\tleft: 96,\n\t\t\tright: 678,\n\t\t\ttop: 246,\n\t\t\tmiddle: 882,\n\t\t\tbottom: 1518,\n\t\t},\n\t\t\/** 13, 13 Pro, 12, 12 Pro *\/\n\t\t2532: {\n\t\t\tsmall: 474,\n\t\t\tmedium: 1014,\n\t\t\tlarge: 1062,\n\t\t\tleft: 78,\n\t\t\tright: 618,\n\t\t\ttop: 231,\n\t\t\tmiddle: 819,\n\t\t\tbottom: 1407,\n\t\t},\n\t\t\/** 11 Pro Max, XS Max *\/\n\t\t2688: {\n\t\t\tsmall: 507,\n\t\t\tmedium: 1080,\n\t\t\tlarge: 1137,\n\t\t\tleft: 81,\n\t\t\tright: 654,\n\t\t\ttop: 228,\n\t\t\tmiddle: 858,\n\t\t\tbottom: 1488,\n\t\t},\n\t\t\/** 11, XR *\/\n\t\t1792: {\n\t\t\tsmall: 338,\n\t\t\tmedium: 720,\n\t\t\tlarge: 758,\n\t\t\tleft: 55,\n\t\t\tright: 437,\n\t\t\ttop: 159,\n\t\t\tmiddle: 579,\n\t\t\tbottom: 999,\n\t\t},\n\t\t\/** 13 mini, 12 mini \/ 11 Pro, XS, X *\/\n\t\t2436: {\n\t\t\tsmall: 465,\n\t\t\tmedium: 987,\n\t\t\tlarge: 1035,\n\t\t\tx: {\n\t\t\t\tleft: 69,\n\t\t\t\tright: 591,\n\t\t\t\ttop: 213,\n\t\t\t\tmiddle: 783,\n\t\t\t\tbottom: 1353,\n\t\t\t},\n\t\t\tmini: {\n\t\t\t\tleft: 69,\n\t\t\t\tright: 591,\n\t\t\t\ttop: 231,\n\t\t\t\tmiddle: 801,\n\t\t\t\tbottom: 1371,\n\t\t\t},\n\t\t},\n\t\t\/** Plus phones *\/\n\t\t2208: {\n\t\t\tsmall: 471,\n\t\t\tmedium: 1044,\n\t\t\tlarge: 1071,\n\t\t\tleft: 99,\n\t\t\tright: 672,\n\t\t\ttop: 114,\n\t\t\tmiddle: 696,\n\t\t\tbottom: 1278,\n\t\t},\n\t\t\/** SE2 and 6\/6S\/7\/8 *\/\n\t\t1334: {\n\t\t\tsmall: 296,\n\t\t\tmedium: 642,\n\t\t\tlarge: 648,\n\t\t\tleft: 54,\n\t\t\tright: 400,\n\t\t\ttop: 60,\n\t\t\tmiddle: 412,\n\t\t\tbottom: 764,\n\t\t},\n\t\t\/** SE1 *\/\n\t\t1136: {\n\t\t\tsmall: 282,\n\t\t\tmedium: 584,\n\t\t\tlarge: 622,\n\t\t\tleft: 30,\n\t\t\tright: 332,\n\t\t\ttop: 59,\n\t\t\tmiddle: 399,\n\t\t\tbottom: 399,\n\t\t},\n\t\t\/** 11 and XR in Display Zoom mode *\/\n\t\t1624: {\n\t\t\tsmall: 310,\n\t\t\tmedium: 658,\n\t\t\tlarge: 690,\n\t\t\tleft: 46,\n\t\t\tright: 394,\n\t\t\ttop: 142,\n\t\t\tmiddle: 522,\n\t\t\tbottom: 902,\n\t\t},\n\t\t\/** Plus in Display Zoom mode *\/\n\t\t2001: {\n\t\t\tsmall: 444,\n\t\t\tmedium: 963,\n\t\t\tlarge: 972,\n\t\t\tleft: 81,\n\t\t\tright: 600,\n\t\t\ttop: 90,\n\t\t\tmiddle: 618,\n\t\t\tbottom: 1146,\n\t\t},\n\t};\n\theight = height || Device.screenResolution().height;\n\tconst scale = Device.screenScale();\n\n\tconst phone = phones[height];\n\tif (phone) {\n\t\treturn phone;\n\t}\n\n\tif (config.runsInWidget) {\n\t\tconst pc = {\n\t\t\tsmall: 164 * scale,\n\t\t\tmedium: 344 * scale,\n\t\t\tlarge: 354 * scale,\n\t\t};\n\t\treturn pc;\n\t}\n\n\t\/\/ in app screen fixed 375x812 pt\n\treturn {\n\t\tsmall: 155 * scale,\n\t\tmedium: 329 * scale,\n\t\tlarge: 345 * scale,\n\t};\n};\n\n\/**\n * 一个基于 Proxy 的 请求对象，用于以一致的接口进行请求。\n *\n * 用法示例:\n * const {body,headers,statusCode} = await http.get(url,timeout).json();\n *\n * const response = await http.post({ url, body, timeout}).str();\n *\n * @param {string} method - HTTP 方法（例如 'get', 'post', 'put', 'delete'）。\n * @param {Object} opts - 请求的选项。\n * @param {string} url - 请求的 URL。\n * @param {number} [timeout=5] - 请求的超时时间，默认为 5 秒。\n *\n * @returns {Object} - 包含三个方法（str, json, imsg）的对象，用于发送请求。\n *   - str: 发送请求并以字符串形式返回响应体。\n *   - json: 发送请求并以 JSON 形式返回响应体。\n *   - image: 发送请求并以 图片对象形式返回响应。\n *\/\nconst http = new Proxy(\n\t{},\n\t{\n\t\tget:\n\t\t\t(_, method) =>\n\t\t\t(opts, timeout = 5) => {\n\t\t\t\tif (!opts.url) opts = { url: opts };\n\t\t\t\topts.timeoutInterval = opts.timeout ?? timeout;\n\n\t\t\t\tconst request = Object.assign(\n\t\t\t\t\tnew Request(opts.url),\n\t\t\t\t\t{ method },\n\t\t\t\t\topts\n\t\t\t\t);\n\n\t\t\t\tconst send = async (loader) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst body = await request[loader]();\n\t\t\t\t\t\tconst { headers, statusCode } = request.response;\n\t\t\t\t\t\tif (statusCode !== 200)\n\t\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t\t`Request failed with status code ${statusCode}`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\treturn { body, headers, statusCode };\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Failed to load ${opts.url}: ${error.toString()}`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\treturn {\n\t\t\t\t\tstr: () => send(\"loadString\"),\n\t\t\t\t\tjson: () => send(\"loadJSON\"),\n\t\t\t\t\timage: () => send(\"loadImage\"),\n\t\t\t\t\tdata: () => send(\"load\"),\n\t\t\t\t};\n\t\t\t},\n\t}\n);\n\n\/**\n * @param {...string} paths\n *\/\nconst joinPath = (...paths) => {\n\tconst fm = FileManager.local();\n\treturn paths.reduce((prev, curr) => {\n\t\treturn fm.joinPath(prev, curr);\n\t}, \"\");\n};\n\n\/**\n * 规范使用 FileManager。每个脚本使用独立文件夹\n *\n * 注意：桌面组件无法写入 cacheDirectory 和 temporaryDirectory\n * @param {object} options\n * @param { boolean| string} [options.useICloud]\n * @param {boolean| string} [options.basePath]\n *\/\n\nconst useFileManager = (options = {}) => {\n\tlet { useICloud, basePath } = options;\n\n\tif (typeof useICloud === \"string\") basePath = useICloud;\n\n\tconst fm = useICloud ? FileManager.iCloud() : FileManager.local();\n\tconst paths = [fm.documentsDirectory(), Script.name()];\n\tif (basePath && typeof basePath === \"string\") {\n\t\tpaths.push(basePath);\n\t}\n\tconst cacheDirectory = joinPath(...paths);\n\n\t\/**\n\t * 删除路径末尾所有的 \/\n\t * @param {string} filePath\n\t *\/\n\tconst safePath = (filePath) => {\n\t\treturn fm.joinPath(cacheDirectory, filePath).replace(\/\\\/+$\/, \"\");\n\t};\n\n\t\/**\n\t * 如果上级文件夹不存在，则先创建文件夹\n\t * @param {string} filePath\n\t *\/\n\tconst preWrite = (filePath) => {\n\t\tconst i = filePath.lastIndexOf(\"\/\");\n\t\tconst directory = filePath.substring(0, i);\n\t\tif (!fm.fileExists(directory)) {\n\t\t\tfm.createDirectory(directory, true);\n\t\t}\n\t};\n\n\t\/**\n\t * @param {string} filePath\n\t * @param {string} stringData\n\t *\/\n\n\tconst writeString = (filePath, content) => {\n\t\tconst nextPath = safePath(filePath);\n\t\tpreWrite(nextPath);\n\t\tfm.writeString(nextPath, content);\n\t};\n\n\t\/**\n\t * @param {string} filePath\n\t * @param {object} jsonData\n\t *\/\n\tconst writeJSON = (filePath, jsonData) =>\n\t\twriteString(filePath, JSON.stringify(jsonData));\n\n\t\/**\n\t * @param {string} filePath\n\t * @param {Image} image\n\t *\/\n\tconst writeImage = (filePath, image) => {\n\t\tconst nextPath = safePath(filePath);\n\t\tpreWrite(nextPath);\n\t\treturn fm.writeImage(nextPath, image);\n\t};\n\n\t\/**\n\t * @param {string} filePath\n\t * @param {*} Data - 数据对象\n\t *\/\n\tconst writeData = (filePath, Data) => {\n\t\tconst nextPath = safePath(filePath);\n\t\tpreWrite(nextPath);\n\t\treturn fm.write(nextPath, Data);\n\t};\n\n\t\/**\n\t * 文件不存在时返回 null\n\t * @param {string} filePath\n\t * @returns {string|null}\n\t *\/\n\tconst readString = (filePath, bool) => {\n\t\tconst fullPath = fm.joinPath(cacheDirectory, filePath);\n\t\tif (fm.fileExists(fullPath)) {\n\t\t\tif (bool) return fullPath;\n\t\t\treturn fm.readString(fm.joinPath(cacheDirectory, filePath));\n\t\t}\n\t\treturn null;\n\t};\n\n\t\/**\n\t * @param {string} filePath\n\t *\/\n\tconst readJSON = (filePath) => JSON.parse(readString(filePath));\n\n\t\/**\n\t * @param {string} filePath\n\t *\/\n\tconst readImage = (filePath, bool) => {\n\t\tconst fullPath = fm.joinPath(cacheDirectory, filePath);\n\n\t\tif (bool) return fullPath;\n\t\treturn fm.readImage(fullPath);\n\t};\n\n\t\/**\n\t * @param {string} filePath\n\t * @returns {any}\n\t *\n\t *\/\n\tconst readData = (filePath, bool) => {\n\t\tconst fullPath = fm.joinPath(cacheDirectory, filePath);\n\t\tif (fm.fileExists(fullPath)) {\n\t\t\tif (bool) return fullPath;\n\t\t\treturn Data.fromFile(fullPath);\n\t\t}\n\t\treturn null;\n\t};\n\n\treturn {\n\t\tfm,\n\t\tcacheDirectory,\n\t\twriteString,\n\t\twriteJSON,\n\t\twriteImage,\n\t\twriteData,\n\t\treadString,\n\t\treadJSON,\n\t\treadImage,\n\t\treadData,\n\t};\n};\n\n\/** 规范使用文件缓存。每个脚本使用独立文件夹 *\/\nconst useCache = (name = \"cache\", path = \"basePath\") =>\n\tuseFileManager({ [path]: name });\n\nconst html = `\n<!DOCTYPE html>\n<html lang=\"en\">\n\t<head>\n\t\t<meta charset=\"UTF-8\" \/>\n\t\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" \/>\n\t\t<title>2048 Game<\/title>\n\t\t<style>\n\t\t:root {\n  --width: 75px;\n  --padding: 10px;\n  --size: 4;\n  --radius: 10px;\n}\n\nbody {\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  background-color: #f0ecdc;\n  font-weight: 900;\n  color: #756e66;\n  font-family: \"Helvetica Neue\", Arial, sans-serif;\n}\n\n.box {\n  display: flex;\n  width: calc(var(--width) * var(--size) + var(--padding) * (var(--size) + 4));\n  flex-direction: column;\n  align-items: center; \n  gap: 25px;\n}\n\n.row {\n  display: flex;\n  justify-content: space-between;\n  width: 100%; \n}\n\n.row:nth-child(3) {\n  justify-content: center;\n}\n\n.game-container {\n  display: flex;\n  font-size: 30px;\n  align-items: center; \n}\n\n.score-box {\n  display: flex;\n  justify-content: flex-end;\n  text-align: center;\n  font-size: 11px;\n  color: #e6d6c4;\n}\n\n.game-over {\n  background-color: #b9ada1;\n  padding-top: 10px;\n  width: 6em;\n  height: 4em;\n  border-radius: 3px;\n}\n\n#bset {\n  background-color: #b9ada1;\n  padding-top: 10px;\n  width: 6em;\n  height: 4em;\n  margin-left: 5px; \n  border-radius: 3px;\n}\n\n#score,\n#bset-score {\n  color: #faf8f0;\n  font-size: 20px;\n}\n\n.message {\n  font-size: 14px;\n  font-weight: 300;\n}\n.message span {\n  font-size: 15px;\n  font-weight: 500;\n}\n\n.message div {\n  font-weight: 400;\n  text-decoration: underline;\n}\n.restartGame {\n  background-color: #8c7b68;\n  color: #f8f6f2;\n  border: none;\n  border-radius: 3px;\n}\n\n.my-2048 {\n  background-color: #b9a1a6;\n  position: relative;\n  width: calc(var(--width) * var(--size) + var(--padding) * (var(--size) - 1));\n  height: calc(var(--width) * var(--size) + var(--padding) * (var(--size) - 1));\n  padding: var(--padding);\n  border-radius: var(--radius);\n}\n\n.bg {\n  display: grid;\n  grid-template-columns: repeat(var(--size), 1fr);\n  gap: var(--padding);\n}\n.bg div {\n  width: var(--width);\n  height: var(--width);\n  background-color: #cbc0b5;\n  color: transparent;\n  border-radius: var(--radius);\n}\n\n.square-content {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n.square-content div {\n  --row: 0;\n  --col: 0;\n\n  width: var(--width);\n  height: var(--width);\n  text-align: center;\n  line-height: var(--width);\n  font-size: 28px;\n  border-radius: var(--radius);\n  position: absolute;\n  top: calc(var(--width) * var(--row) + var(--padding) * (var(--row) + 1));\n  left: calc(var(--width) * var(--col) + var(--padding) * (var(--col) + 1));\n  animation: in .3s;\n  transition: .3s;\n}\n\n@keyframes in {\n  from {\n    opacity: 0;\n    transform: scale(0);\n  }\n\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n} \n\t\t<\/style>\n\t\t\n\t<\/head>\n\n\t<body>\n\t\t<div class=\"box\">\n\t\t\t<!-- 第一排 -->\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"game-container\">2048<\/div>\n\n\t\t\t\t<!-- 分数 -->\n\t\t\t\t<div class=\"score-box\">\n\t\t\t\t\t<!-- 当前得分 -->\n\t\t\t\t\t<div class=\"game-over\">\n\t\t\t\t\t\tSCORE\n\t\t\t\t\t\t<div id=\"score\">0<\/div>\n\t\t\t\t\t<\/div>\n\n\t\t\t\t\t<!-- 最高得分 -->\n\t\t\t\t\t<div id=\"bset\">\n\t\t\t\t\t\tBSET\n\t\t\t\t\t\t<div id=\"bset-score\">0<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<!-- 第二排 -->\n\t\t\t<div class=\"row\">\n\t\t\t\t<!-- 介绍 -->\n\t\t\t\t<div class=\"message\">\n\t\t\t\t\tJoin the tiles, get to <span>2048!<\/span>\n\t\t\t\t\t<div>How to play →<\/div>\n\t\t\t\t<\/div>\n\n\t\t\t\t<!-- 重置 -->\n\t\t\t\t<button class=\"restartGame\">New Game<\/button>\n\t\t\t<\/div>\n\t\t\t<!-- 第三排 -->\n\t\t\t<div class=\"row\">\n\t\t\t\t<div class=\"my-2048\">\n\t\t\t\t\t<!-- 背景 布局 -->\n\t\t\t\t\t<div class=\"bg\"><\/div>\n\n\t\t\t\t\t<div class=\"square-content\"><\/div>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\n\t\t<script>\n\t\t\tconst SIZE = 4;\nconst WIDTH = 75;\nconst PADDING = 10;\n\nconst colorMap = {\n\t0: \"#CBC0B5\",\n\t2: \"#ECE4DB\",\n\t4: \"#ECE1CC\",\n\t8: \"#E9B582\",\n\t16: \"#E99B6D\",\n\t32: \"#E78367\",\n\t64: \"#E56948\",\n\t128: \"#E8D180\",\n};\n\nconst nextFunc = {\n\tArrowUp: (r, c) => [r + 1, c],\n\tArrowDown: (r, c) => [r - 1, c],\n\tArrowLeft: (r, c) => [r, c + 1],\n\tArrowRight: (r, c) => [r, c - 1],\n};\n\nconst fontColor = (num) => {\n\treturn \\`\\${num}\\` === \"0\" ? \"transparent\" : num <= 4 ? \"#756E66\" : \"#F8F6F2\";\n};\n\nconst root = document.querySelector(\":root\");\nroot.style.setProperty(\"--size\", SIZE);\nroot.style.setProperty(\"--width\", WIDTH + \"px\");\nroot.style.setProperty(\"--padding\", PADDING + \"px\");\n\nconst square_Content = document.querySelector(\".square-content\");\nconst tileContainer = {}; \/\/ 存储所有方块的容器\n\n\/\/ 创建累计分数方法\nconst score = document.getElementById(\"score\");\nscore.setScore = (num) => {\n\tif (num) {\n\t\tscore.textContent = +score.textContent + +num;\n\t} else {\n\t\tscore.textContent = 0;\n\t}\n};\n\n\/\/ 记录最高分\nconst data = localStorage.getItem(\"2048\");\nconst best = document.getElementById(\"bset-score\");\nbest.textContent = data ?? 0;\nbest.setBest = () => {\n\tif (+best.textContent < score.textContent) {\n\t\tbest.textContent = +score.textContent;\n\t\tlocalStorage.setItem(\"2048\", score.textContent);\n\t}\n};\n\n\/\/初始化棋盘\nconst board = initializeBoard();\ngenerateRandomSquare(2, board);\nconst pieceCoordinates = () =>\n\tboard\n\t\t.flat()\n\t\t.map((val) => val.textContent)\n\t\t.join(\"\");\n\n\/\/注册键盘事件\ndocument.onkeydown = throttle(({ key }) => {\n\tnextFunc[key] && move(board, key, tileContainer);\n}, 400);\n\n\/\/注册手指滑动事件\ninitSwipe();\n\n\/\/注册重置事件\ndocument.querySelector(\".restartGame\").onclick = () => {\ncompletion(\"刷新\");\nresetGame();\n};\n\n\/\/初始化棋盘\nfunction initializeBoard() {\n\tconst bg = document.querySelector(\".bg\");\n\treturn Array.from({ length: SIZE }, () =>\n\t\tArray.from({ length: SIZE }, () => {\n\t\t\tconst div = document.createElement(\"div\");\n\t\t\tdiv.textContent = 0;\n\t\t\tbg.appendChild(div);\n\t\t\treturn div;\n\t\t})\n\t);\n}\n\n\/\/随机生成棋子\nfunction generateRandomSquare(count = 1, board) {\n\tconst newArr = [];\n\tfor (let i = 0; i < SIZE; i++) {\n\t\tfor (let j = 0; j < SIZE; j++) {\n\t\t\tconst value = board[i][j];\n\t\t\tif (value.textContent === \"0\") {\n\t\t\t\tnewArr.push([i, j]);\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (let i = 0; i < count; i++) setRandom(newArr);\n}\n\nfunction getRandom(max, min) {\n\treturn Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\nfunction setRandom(newArr) {\n\tconst randomIndex = getRandom(newArr.length - 1, 0);\n\tconst randomNum = getRandom(1, 0) ? 2 : 4;\n\n\tconst [r, j] = newArr[randomIndex];\n\tboard[r][j].textContent = randomNum;\n\n\tconst div = document.createElement(\"div\");\n\tdiv.textContent = randomNum;\n\tdiv.style.color = fontColor(randomNum);\n\tdiv.style.backgroundColor = colorMap[randomNum];\n\tdiv.style.setProperty(\"--row\", r);\n\tdiv.style.setProperty(\"--col\", j);\n\ttileContainer[\\`\\${r}-\\${j}\\`] = div;\n\t\/\/ 设置随机位置\n\tsquare_Content.appendChild(div);\n\t\/\/ 删除被选中的元素\n\tnewArr.splice(randomIndex, 1);\n}\n\n\/\/ 实现移动逻辑\nfunction move(board, direction, tileContainer) {\n\tconst r = board.length; \/\/y轴\n\tconst c = board[0].length; \/\/x轴\n\n\t\/\/判断当前位置是否超出边界\n\tconst isValid = (row, col) => {\n\t\treturn row >= 0 && row < r && col >= 0 && col < c;\n\t};\n\n\t\/\/判断下一个不为0的位置\n\tconst getNextNoZero = (row, col) => {\n\t\tlet [nextR, nextC] = nextFunc[direction](row, col);\n\n\t\twhile (isValid(nextR, nextC)) {\n\t\t\tconst value = +board[nextR][nextC].textContent;\n\t\t\tif (value !== 0) {\n\t\t\t\treturn [nextR, nextC, value];\n\t\t\t}\n\n\t\t\t[nextR, nextC] = nextFunc[direction](nextR, nextC);\n\t\t}\n\t};\n\n\t\/\/设置属性\n\tconst setAttribute = (item, value) => {\n\t\titem.textContent = value;\n\t\titem.style.color = fontColor(value);\n\t\titem.style.backgroundColor = colorMap[value];\n\t};\n\n\t\/\/动画方法\n\tconst animateElement = (nextR, nextC, r, c, value) => {\n\t\t\/\/开始移动动画\n\t\tconst div = tileContainer[\\`\\${nextR}-\\${nextC}\\`];\n\t\tif (div) {\n\t\t\tdiv.style.setProperty(\"--row\", r);\n\t\t\tdiv.style.setProperty(\"--col\", c);\n\t\t\tdiv.ontransitionend = () => setAttribute(div, value);\n\n\t\t\ttileContainer[\\`\\${nextR}-\\${nextC}\\`] = void 0;\n\t\t\ttileContainer[\\`\\${r}-\\${c}\\`] = div;\n\t\t}\n\t};\n\n\t\/\/ 移动逻辑\n\tconst createNewBoard = (r, c) => {\n\t\tfor (;;) {\n\t\t\tlet [nextR, nextC, nextValue] = getNextNoZero(r, c) ?? [];\n\t\t\tif (!nextValue) return;\n\t\t\tlet value = +board[r][c].textContent;\n\t\t\tif (value === 0) {\n\t\t\t\tboard[r][c].textContent = nextValue;\n\t\t\t\tboard[nextR][nextC].textContent = 0;\n\t\t\t\tanimateElement(nextR, nextC, r, c, nextValue);\n\t\t\t} else if (+value === +nextValue) {\n\t\t\t\tboard[r][c].textContent = value * 2;\n\t\t\t\tboard[nextR][nextC].textContent = 0;\n\t\t\t\tconst oldDiv = tileContainer[\\`\\${r}-\\${c}\\`];\n\n\t\t\t\tsetTimeout(() => square_Content.removeChild(oldDiv), 300);\n\n\t\t\t\tscore.setScore(value * 2);\n\t\t\t\tbest.setBest();\n\t\t\t\tanimateElement(nextR, nextC, r, c, value * 2);\n\t\t\t\tbreak;\n\t\t\t} else break;\n\t\t}\n\n\t\t\/\/递归 对下一颗棋子计算\n\t\tcreateNewBoard(...nextFunc[direction](r, c));\n\t};\n\n\tconst piece = pieceCoordinates();\n\t\/\/ 移动方向\n\tswitch (direction) {\n\t\tcase \"ArrowUp\":\n\t\t\tfor (let i = 0; i < c; i++) createNewBoard(0, i);\n\t\t\tbreak;\n\n\t\tcase \"ArrowDown\":\n\t\t\tfor (let i = 0; i < c; i++) createNewBoard(r - 1, i);\n\t\t\tbreak;\n\n\t\tcase \"ArrowLeft\":\n\t\t\tfor (let i = 0; i < r; i++) createNewBoard(i, 0);\n\t\t\tbreak;\n\n\t\tcase \"ArrowRight\":\n\t\t\tfor (let i = 0; i < r; i++) createNewBoard(i, c - 1);\n\t\t\tbreak;\n\t}\n\n\tpiece !== pieceCoordinates() &&\n\t\tsetTimeout(() => {\n\t\t\tgenerateRandomSquare(1, board);\n\t\t}, 300);\n\n\tif (isGameOver()) {\n\t\tsetTimeout(() => {\n      completion(\\`Game Over 分数: \\${score.textContent}\\`);\n\t\t\t\n\n\t\t\talert(\"Game Over\");\n\t\t\tresetGame();\n\t\t\tscore.setScore();\n\t\t}, 300);\n\t}\n}\n\n\/\/ 游戏结束\nfunction isGameOver() {\n\tconst arr = [];\n\tfor (let i = 0; i < board.length; i++) {\n\t\tfor (let j = 0; j < board[0].length; j++) {\n\t\t\tconst value = board[i][j].textContent;\n\t\t\tif (value === \"0\") return;\n\t\t\tarr[i] ||= [];\n\t\t\tarr[i][j] = value;\n\t\t}\n\t}\n\n\t\/\/ 检查行和列是否相邻\n\n\tfor (let i of arr) {\n\t\t\/\/ 从左到右检查相邻元素是否相等\n\t\tfor (let j = 0; j < i.length - 1; j++) {\n\t\t\tconst a = i[j];\n\t\t\tconst b = i[j + 1];\n\t\t\tif (a === b) return;\n\t\t}\n\n\t\t\/\/ 从右到左检查相邻元素是否相等\n\t\tfor (let j = i.length - 1; j > 0; j--) {\n\t\t\tconst a = i[j];\n\t\t\tconst b = i[j - 1];\n\t\t\tif (a === b) return;\n\t\t}\n\t}\n\n\tfor (let j = 0; j < arr[0].length; j++) {\n\t\t\/\/ 从下到上检查相邻元素是否相等\n\t\tfor (let i = arr.length - 1; i > 0; i--) {\n\t\t\tconst a = arr[i][j];\n\t\t\tconst b = arr[i - 1][j];\n\t\t\tif (a === b) return;\n\t\t}\n\n\t\t\/\/ 从上到下检查相邻元素是否相等\n\t\tfor (let i = 0; i < arr.length - 1; i++) {\n\t\t\tconst a = arr[i][j];\n\t\t\tconst b = arr[i + 1][j];\n\t\t\tif (a === b) return;\n\t\t}\n\t}\n\treturn true;\n}\n\n\/\/重置游戏\nfunction resetGame() {\n\tsquare_Content.innerHTML = \"\";\n\tboard.flat().forEach((div) => (div.textContent = 0));\n\tgenerateRandomSquare(2, board);\n}\n\n\/\/ 初始化滑动事件\nfunction initSwipe() {\n\tlet startX = 0;\n\tlet startY = 0;\n\tsquare_Content.ontouchstart = (e) => {\n\t\te.preventDefault();\n\t\tstartX = e.targetTouches[0].clientX;\n\t\tstartY = e.targetTouches[0].clientY;\n\t};\n\n\tsquare_Content.ontouchend = ({ changedTouches }) => {\n\t\tconst endX = changedTouches[0].clientX;\n\t\tconst endY = changedTouches[0].clientY;\n\n\t\t\/\/ 判断方向\n\t\tconst deltaX = endX - startX;\n\t\tconst deltaY = endY - startY;\n\n\t\tconst direction = () => {\n\t\t\tif (Math.abs(deltaX) > Math.abs(deltaY)) {\n\t\t\t\treturn deltaX > 0 ? \"ArrowRight\" : \"ArrowLeft\";\n\t\t\t} else {\n\t\t\t\treturn deltaY > 0 ? \"ArrowDown\" : \"ArrowUp\";\n\t\t\t}\n\t\t};\n\n\t\tconst distanceBetweenPoints = () => {\n\t\t\treturn Math.sqrt(deltaX * deltaX + deltaY * deltaY) > 50;\n\t\t};\n\n\t\tdistanceBetweenPoints() && move(board, direction(), tileContainer);\n\n\t\tstartX = 0;\n\t\tstartY = 0;\n\t};\n}\n\n\/\/节流\nfunction throttle(func, delay) {\n\tlet waiting = false;\n\treturn function (...args) {\n\t\tif (!waiting) {\n\t\t\tfunc.apply(this, args);\n\t\t\twaiting = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\twaiting = false;\n\t\t\t}, delay);\n\t\t}\n\t};\n}\n\n\t\t<\/script>\n\t<\/body>\n<\/html>\n`;\n\nconst playGame2048 = async () => {\n\tconst localFM = useCache(\"2048\");\n\tconst htmlpath = joinPath(localFM.cacheDirectory, \"2048.html\");\n\n\tif (localFM.readString(\"2048.html\") !== html) {\n\t\tlocalFM.writeString(\"2048.html\", html);\n\t}\n\n\tconst wv = new WebView();\n\twv.loadFile(htmlpath);\n\n\tconst showAlert = (title) =>\n\t\tnew Alert().myProxy({\n\t\t\ttitle,\n\t\t\tpresentAlert: true,\n\t\t});\n\n\tconst recursiveAlert = () =>\n\t\twv.evaluateJavaScript(\"\", true).then(showAlert).then(recursiveAlert);\n\n\trecursiveAlert();\n\n\tawait wv.present();\n};\n\nconst addTitleName = (topLeft) => {\n\t\/\/计算宽度\n\tconst body = BillData.find((i) => i.title === \"用户\").value;\n\tconst len = body.includes(\"*\") ? body.length + 0.5 : body.length + 1;\n\n\ttopLeft.addStack().myProxy({\n\t\tcenterAlignContent: true,\n\t\tsize: new Size(len * 18 + 10 + 2, topLeft.size.height \/ 4),\n\t\t\/\/backgroundColor: Color.blue(),\n\n\t\taddImage: [\n\t\t\ticons.getImage(\"家\"),\n\t\t\t{\n\t\t\t\ttintColor: icons.color,\n\t\t\t\timageSize: icons.largeSize,\n\t\t\t},\n\t\t],\n    addSpacer: 10,\n\t\t\n    addText: [\n\t\t\tbody,\n\t\t\t{\n\t\t\t\ttextColor: BillStyle.color,\n\t\t\t\tfont: BillStyle.largeFont,\n\t\t\t\turl: \"scriptable:\/\/\/run?scriptName=国上国网&event=switchAcc\",\n\t\t\t},\n\t\t],\n\t\t\n\t})\n\t.myProxy({\n\t\taddSpacer: 2,\n\t})\n};\n\nconst addIcon = (topLeft, newWidth, newheight) => {\n\ttopLeft\n\t\t.addStack()\n\t\t.myProxy({\n\t\t\tcenterAlignContent: true,\n\t\t\tsize: new Size(\n\t\t\t\tnewWidth ?? topLeft.size.width * 0.39,\n\t\t\t\tnewheight ?? topLeft.size.height \/ 4\n\t\t\t),\n\t\t\t\/\/backgroundColor: Color.red(),\n\n\t\t\taddText: [\n\t\t\t\tisOverdue ? \"欠费\" :\"余额\",\n\t\t\t\t{\n\t\t\t\t\ttextColor: BillStyle.color,\n\t\t\t\t\tfont: BillStyle.mediumFont,\n\t\t\t\t},\n\t\t\t],\n\t\t\taddSpacer: 5,\n\t\t\taddImage: [\n\t\t\t\ticons.getImage(\"闪电\"),\n\t\t\t\t{\n\t\t\t\t\ttintColor: icons.color,\n\t\t\t\t\timageSize: icons.smallSize,\n\t\t\t\t\timageOpacity: 0.5,\n\t\t\t\t},\n\t\t\t],\n\t\t})\n\t\t.myProxy({\n\t\t\taddSpacer: 5,\n\t\t\taddText: [\n\t\t\t\t\"|\",\n\t\t\t\t{\n\t\t\t\t\ttextColor: BillStyle.color,\n\t\t\t\t\tfont: BillStyle.smallFont,\n\t\t\t\t},\n\t\t\t],\n\t\t})\n\t\t.myProxy({\n\t\t\taddSpacer: 5,\n\t\t\taddImage: [\n\t\t\t\ticons.getImage(\"眼睛\"),\n\t\t\t\t{\n\t\t\t\t\ttintColor: icons.color,\n\t\t\t\t\timageSize: icons.smallSize,\n\t\t\t\t\timageOpacity: 0.5,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n};\n\nconst addBalance = (topLeft) => {\n\tconst body = BillData.find((i) => i.title === \"余额\").value;\n\tlet [int, decimal] = (+body).toFixed(2).split(\".\");\n\tint = isOverdue ? \"-\" + int : int;\n\tconst width = topLeft.size.width;\n\tconst height = topLeft.size.height \/ 4;\n\n\tlet w = -1;\n\tconst w_Init = 0;\n\n\tconst ctx = new DrawContext();\n\tctx.size = new Size(width, height);\n\tctx.opaque = false;\n\tctx.respectScreenScale = true;\n\n\t\/\/27号字体的宽度\n\tlet fontWidthList = {\n\t\t\"-\":13,\n\t\t0: 18,\n\t\t1: 13,\n\t\t2: 17,\n\t\t3: 17,\n\t\t4: 18,\n\t\t5: 17,\n\t\t6: 18,\n\t\t7: 16,\n\t\t8: 18,\n\t\t9: 18,\n\t};\n\n\tw += w_Init;\n\tctx.setFont(Font.boldSystemFont(27));\n\tctx.drawText(int, new Point(w, -2));\n\n\tint.split(\"\").forEach((n) => (w += fontWidthList[n]));\n\n\tctx.setFont(Font.boldSystemFont(17));\n\tctx.drawTextInRect(\".\" + decimal, new Rect(w, 7, width, height));\n\n\tdecimal.split(\"\").forEach((n) => (w += n == 1 ? 12 : 14));\n\n\tctx.drawTextInRect(\"元\", new Rect(w, 6, width, height));\n\n\tw += 15 + 5;\n\tctx.drawImageAtPoint(icons.getImage(\"刷新\", 12), new Point(w, 11));\n\n\ttopLeft.addStack().myProxy({\n\t\tsize: new Size(width, height),\n\t\t\/\/backgroundColor: Color.green(),\n\n\t\taddImage: [\n\t\t\tctx.getImage(),\n\t\t\t{\n\t\t\t\ttintColor: isOverdue ? new Color(\"#B32E4E\") : icons.color,\n\t\t\t\turl: \"scriptable:\/\/\/run?scriptName=国上国网&event=refreshData\"\n\t\t\t},\n\t\t],\n\t});\n};\n\nconst addDeadline = (topLeft) => {\n\tconst body = \"截至\" + BillData.find((i) => i.title === \"截至日期\").value;\n\tconst width = topLeft.size.width;\n\tconst height = topLeft.size.height \/ 4;\n\n\tconst ctx = new DrawContext();\n\tctx.size = new Size(width, height);\n\tctx.opaque = false;\n\tctx.respectScreenScale = true;\n\tctx.setFont(BillStyle.mediumFont);\n\tctx.drawText(body, new Point(-1, 9));\n\n\ttopLeft.addStack().myProxy({\n\t\tcenterAlignContent: true,\n\t\tsize: new Size(width, height),\n\t\t\/\/backgroundColor: Color.black(),\n\n\t\taddImage: [\n\t\t\tctx.getImage(),\n\t\t\t{\n\t\t\t\ttintColor: icons.color,\n\t\t\t},\n\t\t],\n\t});\n};\n\nconst containerTopLeft = (containerTop) =>\n\tcontainerTop.addStack().myProxy({\n\t\tlayoutVertically: true,\n\t\tsize: new Size(containerTop.size.width * 0.6, containerTop.size.height),\n\t\t\/\/backgroundColor: Color.brown(),\n\n\t\taddTitleName,\n\t\taddIcon,\n\t\taddBalance,\n\t\taddDeadline,\n\t});\n\nconst setPaymentPage = (\n\twidget,\n\twidth,\n\theight,\n\ttext = \"去交费\",\n\ticon = icons.getImage(\"货币\"),\n\turl = \"com.wsgw.e.zsdl:\/\/platformapi\/\"\n) =>\n\twidget.addStack().myProxy({\n\t\tcenterAlignContent: true,\n\t\tsize: new Size(width * 0.6, height),\n\t\tcornerRadius: 20,\n\t\tbackgroundGradient: Gradient([\n\t\t\t\"#E7EEF0\",\n\t\t\t\"#E7EEEF\",\n\t\t\t\"#2C334D\",\n\t\t\t\"#242A43\",\n\t\t]),\n\n\t\t\/\/ 添加图标\n\t\taddImage: [\n\t\t\ticon,\n\t\t\t{\n\t\t\t\timageSize: icons.largeSize,\n\t\t\t\ttintColor: icons.color,\n\t\t\t},\n\t\t],\n\n\t\taddSpacer: 2,\n\n\t\t\/\/ 添加文字\n\t\taddText: [\n\t\t\ttext,\n\t\t\t{\n\t\t\t\ttextColor: BillStyle.color,\n\t\t\t\tfont: BillStyle.mediumFont,\n\t\t\t\turl,\n\t\t\t},\n\t\t],\n\t});\n\nconst setDate = (w, options = {}) =>\n\tw.myProxy({\n\t\taddDate: [\n\t\t\tnew Date(),\n\t\t\t{\n\t\t\t\tfont: BillStyle.smallFont,\n\t\t\t\tapplyTimeStyle: true,\n\t\t\t\ttextColor: icons.color,\n\t\t\t\ttextOpacity: 0.8,\n\t\t\t\t...options,\n\t\t\t},\n\t\t],\n\t});\n\nconst containerTopRight = (containerTop) =>\n\tcontainerTop.addStack().myProxy({\n\t\tlayoutVertically: true,\n\t\tsize: new Size(containerTop.size.width * 0.4, containerTop.size.height),\n\t\t\/\/backgroundColor: Color.red(),\n\n\t\trenderPaymentPage(TopRight) {\n\t\t\tconst width = TopRight.size.width;\n\t\t\tconst height = TopRight.size.height * 0.31;\n\n\t\t\tTopRight.addStack()\n\t\t\t\t.myProxy({\n\t\t\t\t\tsize: new Size(width, height),\n\t\t\t\t\taddSpacer: width * 0.40,\n\t\t\t\t})\n\t\t\t\t.addStack()\n\t\t\t\t.myProxy({\n\t\t\t\t\t$: (w) => setPaymentPage(w, width, height),\n\t\t\t\t});\n\t\t},\n\n\t\taddSpacer: containerTop.size.height * 0.1,\n\n\t\taddGame2048(TopRight) {\n\t\t\tconst width = TopRight.size.width;\n\t\t\tconst height = TopRight.size.height * 0.31;\n\n\t\t\tTopRight.addStack()\n\t\t\t\t.myProxy({\n\t\t\t\t\tsize: new Size(width, height),\n\t\t\t\t\taddSpacer: width * 0.40,\n\t\t\t\t})\n\t\t\t\t.addStack()\n\t\t\t\t.myProxy({\n\t\t\t\t\t$: (w) =>\n\t\t\t\t\t\tsetPaymentPage(\n\t\t\t\t\t\t\tw,\n\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\theight,\n\t\t\t\t\t\t\t\"2048\",\n\t\t\t\t\t\t\ticons.getImage(\"游戏\"),\n\t\t\t\t\t\t\t\"scriptable:\/\/\/run?scriptName=国上国网&event=playGame2048\"\n\t\t\t\t\t\t),\n\t\t\t\t});\n\t\t},\n\n\t\tupdateTime(TopRight) {\n\t\t\tTopRight.addStack().myProxy({\n\t\t\t\tbottomAlignContent: true,\n\t\t\t\tsize: new Size(\n\t\t\t\t\tTopRight.size.width,\n\t\t\t\t\tTopRight.size.height * 0.25\n\t\t\t\t),\n\t\t\t\t\/\/backgroundColor: Color.gray(),\n\n\t\t\t\taddSpacer: 75,\n\t\t\t\tsetDate,\n\t\t\t});\n\t\t},\n\t});\n\nconst createContainerTop = (container) =>\n\tcontainer.addStack().myProxy({\n\t\ttopAlignContent: true,\n\t\tsize: new Size(container.size.width, container.size.height * 0.7),\n\t\t\/\/backgroundColor: Color.gray(),\n\n\t\tcontainerTopLeft,\n\t\tcontainerTopRight,\n\t});\n\nconst createContainerBottom = (container) =>\n\tcontainer.addStack().myProxy({\n\t\tcenterAlignContent: true,\n\t\tsize: new Size(container.size.width, container.size.height * 0.3),\n\t\t\/\/backgroundColor: Color.gray(),\n\n\t\tpopulateBottomContainer(containerbottom) {\n\t\t\tconst newData = BillData.filter(\n\t\t\t\t(i) => !\/用户|余额|截至日期|是否欠费\/.test(i.title)\n\t\t\t);\n\t\t\tnewData.forEach((item) => {\n\t\t\t\tconst col = containerbottom.addStack().myProxy({\n\t\t\t\t\tlayoutVertically: true,\n\t\t\t\t\tsize: new Size(\n\t\t\t\t\t\tcontainerbottom.size.width \/ newData.length,\n\t\t\t\t\t\tcontainerbottom.size.height\n\t\t\t\t\t),\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tcontainerbottom.addSpacer(4);\n\t\t\t\t\n\t\t\t\tObject.keys(item).forEach((k) => {\n\t\t\t\t\tconst row = col.addStack().myProxy({\n\t\t\t\t\t\tsize: new Size(\n\t\t\t\t\t\t\tcol.size.width,\n\t\t\t\t\t\t\tcol.size.height \/ Object.keys(item).length\n\t\t\t\t\t\t),\n\t\t\t\t\t});\n\n\t\t\t\t\tconst result = item[k];\n\n\t\t\t\t\tif (k === \"value\") {\n\t\t\t\t\t\tconst unit = item.title.includes(\"电量\") ? \"度\" : \"元\";\n\t\t\t\t\t\trow.myProxy({\n\t\t\t\t\t\t\tbottomAlignContent: true,\n\t\t\t\t\t\t\taddText: [\n\t\t\t\t\t\t\t\t(+result).toFixed(2),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttextColor: BillStyle.color,\n\t\t\t\t\t\t\t\t\tfont: BillStyle.mediumFont,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}).myProxy({\n\t\t\t\t\t\t\taddText: [\n\t\t\t\t\t\t\t\tunit,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttextColor: BillStyle.color,\n\t\t\t\t\t\t\t\t\tfont: BillStyle.smallFont,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\trow.myProxy({\n\t\t\t\t\t\t\tcenterAlignContent: true,\n\t\t\t\t\t\t\taddText: [\n\t\t\t\t\t\t\t\tresult,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttextColor: BillStyle.color,\n\t\t\t\t\t\t\t\t\tfont: BillStyle.smallFont,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t});\n\n\/\/ 中型小组件\nconfig.mediumRender = (widget) => {\n\twidget.addStack().myProxy({\n\t\tlayoutVertically: true,\n\t\tsize: new Size(...config.familySize),\n\t\t\/\/backgroundColor: Color.gray(),\n\n\t\tcreateContainerTop,\n\t\tcreateContainerBottom,\n\t});\n};\n\n\/\/ 小型小组件\nconfig.smallRender = (widget) => {\n\twidget.addStack().myProxy({\n\t\tlayoutVertically: true,\n\t\tsize: new Size(...config.familySize),\n\n\t\taddTitleName,\n\t\t$: (widget) => addIcon(widget, widget.size.Width * 0.5),\n\n\t\taddBalance,\n\t\tsetRenderPaymentPage(widget) {\n\t\t\tconst w = widget.addStack();\n\t\t\tw.centerAlignContent();\n\t\t\tw.addSpacer(5);\n\t\t\tsetDate(w);\n\t\t\tw.addSpacer(27);\n\t\t\tsetPaymentPage(w, 130, 26);\n\t\t},\n\t});\n};\n\nconst createWidget = (widget) => {\n\tconst screen = Device.screenResolution();\n\tconst size = phoneSize(screen.height);\n\tconst scale = Device.screenScale();\n\tconst family = config.widgetFamily;\n\n\tconst widthPX = family === \"large\" ? size.medium : size[family];\n\tconst heightPX = family === \"medium\" ? size.small : size[family];\n\n\tconst height = heightPX \/ scale;\n\tconst width = widthPX \/ scale;\n\tconfig.familySize = [width - 30, height - 15];\n\n\tconfig[family + \"Render\"](widget);\n};\n\nconst Gradient = ([light1, light2, dark1, dark2]) =>\n\tnew LinearGradient().myProxy({\n\t\tcolors: [\n\t\t\tColor.dynamic(new Color(light2), new Color(dark2)),\n\n\t\t\tColor.dynamic(new Color(light1), new Color(dark1)),\n\t\t],\n\t\tlocations: [0.05, 1],\n\t\tstartPoint: new Point(1, 1),\n\t});\n\nclass UIData {\n\tstatic fileName = \"settings.json\";\n\tstatic iCloudFM = useFileManager({ useICloud: true });\n\n\tstatic async create(url) {\n\t\tconst instance = new UIData();\n\t\tawait instance.fetchData(url);\n\t\treturn instance;\n\t}\n\n\tconstructor(data = null) {\n\t\tthis.update_interval = 6 * 3600000;\n\t\tthis.last_update_time = 0;\n\t\tthis.index = 0;\n\t\tthis.data = data;\n\t\tthis.init();\n\t}\n\t\n\tinit(){\n\t\tconst cache = UIData.iCloudFM.readJSON(UIData.fileName) ?? {};\n\t\t\n\t\tcache.update_interval = this.update_interval;\n\t\t\n\t\tObject.assign(this, cache);\n\t}\n\n\tget isUpdatable() {\n\t\tconst timeElapsed = Date.now() - this.last_update_time;\n\t\treturn timeElapsed >= this.update_interval;\n\t}\n\n\tasync fetchData(url) {\n\t\tUIData.url ||= url;\n\n\t\tif (this.isUpdatable) {\n\t\t\tconst { body } = await http.get(UIData.url, 30).json();\n\n\t\t\tif (!body) throw new Error(\"请求失败,请安装模块 检查boxjs配置\");\n\n\t\t\tthis.last_update_time = Date.now();\n\t\t\tthis.data = body;\n\t\t}\n\t}\n\n\tseverData() {\n\t\tUIData.iCloudFM.writeJSON(UIData.fileName, this);\n\t}\n\n\tasync getData() {\n\t\tawait this.event();\n\t\tthis.updateIndex();\n\t\tthis.severData();\n\t\t\n\t\treturn this.data?.[this.index];\n\t}\n\n\tupdateIndex() {\n\t\tconst i = args.widgetParameter;\n\t\tif (!i) return;\n\t\tif (!this.data[i]) throw new Error(\"户号不存在\");\n\t\tthis.index = i;\n\t}\n\t\n\tasync event() {\n\t\tconst eventFunction = this[\"_api_\" + args.queryParameters.event];\n    \n\t\tif (eventFunction) {\n\t\t\tawait eventFunction.call(this)\n\t\t}\n\t}\n\t\n\tasync _api_refreshData(){\n     const result = await generateAlert(\"是否强制刷新数据\",[\"是\",\"否\"])\n\t\t if (result === \"否\") return;\n\t\t\n\t\tthis.last_update_time = 0;\n    await this.fetchData();\n\t}\n\n\tasync _api_switchAcc() {\n\t\tconst options = this.data.map((item) => {\n\t\t\tconst { value: title } = item.find((i) => i.title === \"用户\");\n\t\t\treturn { title };\n\t\t});\n\n\t\tconst { value: index } = await presentSheet({\n\t\t\ttitle: \"户号\",\n\t\t\tmessage: \"请选择要展示的户号\",\n\t\t\toptions,\n\t\t\tcancelText: \"取消\",\n\t\t});\n\n\t\tif (index !== -1) this.index = index;\n\t}\n\n\tasync _api_playGame2048() {\n\t\tawait playGame2048();\n\t}\n}\n\nconst uiData = await UIData.create(\n\t\"http:\/\/api.example.com\/electricity\/bill\/all\"\n);\n\nconst BillData = await uiData.getData();\n\nconst isOverdue = BillData.find(i => i.title === \"是否欠费\").value;\n\nnew ListWidget().myProxy({\n\t\/\/ 设置背景渐变\n\tbackgroundGradient: Gradient([\"#E9F2EF\", \"#99B3C6\", \"#2B3551\", \"#090B21\"]),\n\n\t\/\/ 运行小组件\n\trun(widget) {\n\t\tif (config.runsInWidget) {\n\t\t\tcreateWidget(widget);\n\t\t\tScript.setWidget(widget);\n\t\t} else {\n\t\t\tconfig.widgetFamily = \"medium\";\n\t\t\tcreateWidget(widget);\n\t\t\twidget.presentMedium();\n\t\t}\n\n\t\tScript.complete();\n\t},\n});\n",
  "share_sheet_inputs" : [

  ]
}