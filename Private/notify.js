const getEnv=()=>"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":eval('typeof process !== "undefined"')?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":void 0,notify=(e="",t="",s="",a={})=>{const n=e=>{const{$open:t,$copy:s,$media:a,$mediaMime:n}=e;switch(typeof e){case void 0:return e;case"string":switch(getEnv()){case"Surge":case"Stash":default:return{url:e};case"Loon":case"Shadowrocket":return e;case"Quantumult X":return{"open-url":e};case"Node.js":return}case"object":switch(getEnv()){case"Surge":case"Stash":case"Shadowrocket":default:{const o={};let r=e.openUrl||e.url||e["open-url"]||t;r&&Object.assign(o,{action:"open-url",url:r});let i=e["update-pasteboard"]||e.updatePasteboard||s;if(i&&Object.assign(o,{action:"clipboard",text:i}),a){let e,t,s;if(a.startsWith("http"))e=a;else if(a.startsWith("data:")){const[e]=a.split(";"),[,n]=a.split(",");t=n,s=e.replace("data:","")}else{t=a,s=(e=>{const t={JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"};for(var s in t)if(0===e.indexOf(s))return t[s];return null})(a)}Object.assign(o,{"media-url":e,"media-base64":t,"media-base64-mime":n??s})}return Object.assign(o,{"auto-dismiss":e["auto-dismiss"],sound:e.sound}),o}case"Loon":{const s={};let n=e.openUrl||e.url||e["open-url"]||t;n&&Object.assign(s,{openUrl:n});let o=e.mediaUrl||e["media-url"];return a?.startsWith("http")&&(o=a),o&&Object.assign(s,{mediaUrl:o}),console.log(JSON.stringify(s)),s}case"Quantumult X":{const n={};let o=e["open-url"]||e.url||e.openUrl||t;o&&Object.assign(n,{"open-url":o});let r=e["media-url"]||e.mediaUrl;a?.startsWith("http")&&(r=a),r&&Object.assign(n,{"media-url":r});let i=e["update-pasteboard"]||e.updatePasteboard||s;return i&&Object.assign(n,{"update-pasteboard":i}),console.log(JSON.stringify(n)),n}case"Node.js":return}default:return}};switch(getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(e,t,s,n(a));break;case"Quantumult X":$notify(e,t,s,n(a));case"Node.js":}let o=["","==============📣系统通知📣=============="];o.push(e),t&&o.push(t),s&&o.push(s),console.log(o.join("\n"))},done=(e={})=>{switch(getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:$done(e);break;case"Node.js":process.exit(1)}},headers=Object.fromEntries(Object.entries($request.headers).map((([e,t])=>[e.toLowerCase(),t])));$response?.body?.match(/#EXTM3U|#EXT-X-ENDLIST/)&&headers?.["x-playback-session-id"]&&"*/*"==headers?.accept&&"video"===headers?.["sec-fetch-dest"]&&notify("完整版视频链接已经捕获成功 🛠","","点击一下此通知即可在线观看 🔞","https://m3u8play.com/?play="+encodeURIComponent($request.url)),done();
